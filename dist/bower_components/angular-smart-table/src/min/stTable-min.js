ng.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs",function t(e,n,r,i){function s(t){return t?[].concat(t):[]}function c(){f=s(l(e)),S===!0&&g.pipe()}var a=i.stTable,o=n(a),u=o.assign,l,h=r("orderBy"),p=r("filter"),f=s(o(e)),d={sort:{},search:{},pagination:{start:0}},S=!0,g=this,b;i.stSafeSrc&&(l=n(i.stSafeSrc),e.$watch(function(){var t=l(e);return t?t.length:0},function(t,e){t!==f.length&&c()}),e.$watch(function(){return l(e)},function(t,e){t!==e&&c()})),this.sortBy=function m(t,e){return d.sort.predicate=t,d.sort.reverse=e===!0,ng.isFunction(t)?d.sort.functionName=t.name:delete d.sort.functionName,d.pagination.start=0,this.pipe()},this.search=function v(t,e){var n=d.search.predicateObject||{},r=e?e:"$";return t=ng.isString(t)?t.trim():t,n[r]=t,t||delete n[r],d.search.predicateObject=n,d.pagination.start=0,this.pipe()},this.pipe=function F(){var t=d.pagination,n=d.search.predicateObject?p(f,d.search.predicateObject):f;d.sort.predicate&&(n=h(n,d.sort.predicate,d.sort.reverse)),void 0!==t.number&&(t.numberOfPages=n.length>0?Math.ceil(n.length/t.number):1,t.start=t.start>=n.length?(t.numberOfPages-1)*t.number:t.start,n=n.slice(t.start,t.start+parseInt(t.number))),u(e,n)},this.select=function O(t,e){var n=f,r=n.indexOf(t);-1!==r&&("single"===e?(t.isSelected=t.isSelected!==!0,b&&(b.isSelected=!1),b=t.isSelected===!0?t:void 0):n[r].isSelected=!n[r].isSelected)},this.slice=function j(t,e){return d.pagination.start=t,d.pagination.number=e,this.pipe()},this.tableState=function T(){return d},this.setFilterFunction=function P(t){p=r(t)},this.setSortFunction=function w(t){h=r(t)},this.preventPipeOnWatch=function y(){S=!1}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(t,e,n,r){n.stSetFilter&&r.setFilterFunction(n.stSetFilter),n.stSetSort&&r.setSortFunction(n.stSetSort)}}});