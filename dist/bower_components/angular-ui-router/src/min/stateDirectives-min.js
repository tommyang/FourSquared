function parseStateRef(e,t){var r=e.match(/^\s*({[^}]*})\s*$/),a;if(r&&(e=t+"("+r[1]+")"),a=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/),!a||4!==a.length)throw new Error("Invalid state ref '"+e+"'");return{state:a[1],paramExpr:a[3]||null}}function stateContext(e){var t=e.parent().inheritedData("$uiView");return t&&t.state&&t.state.name?t.state:void 0}function $StateRefDirective(e,t){var r=["location","inherit","reload"];return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(a,i,n,c){var u=parseStateRef(n.uiSref,e.current.name),f=null,o=null,s=stateContext(i)||e.$current,v=null,l="A"===i.prop("tagName"),p="FORM"===i[0].nodeName,S=p?"action":"href",m=!0,d={relative:s,inherit:!0},h=a.$eval(n.uiSrefOpts)||{};angular.forEach(r,function(e){e in h&&(d[e]=h[e])});var A=function(t){if(t&&(f=angular.copy(t)),m){v=e.href(u.state,f,d);var r=c[1]||c[0];return r&&r.$$setStateInfo(u.state,f),null===v?(m=!1,!1):void n.$set(S,v)}};u.paramExpr&&(a.$watch(u.paramExpr,function(e,t){e!==f&&A(e)},!0),f=angular.copy(a.$eval(u.paramExpr))),A(),p||i.bind("click",function(r){var a=r.which||r.button;if(!(a>1||r.ctrlKey||r.metaKey||r.shiftKey||i.attr("target"))){var n=t(function(){e.go(u.state,f,d)});r.preventDefault();var c=l&&!v?1:0;r.preventDefault=function(){c--<=0&&t.cancel(n)}}})}}}function $StateRefActiveDirective(e,t,r){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,a,i){function n(){c()?a.addClass(o):a.removeClass(o)}function c(){return"undefined"!=typeof i.uiSrefActiveEq?u&&e.is(u.name,f):u&&e.includes(u.name,f)}var u,f,o;o=r(i.uiSrefActiveEq||i.uiSrefActive||"",!1)(t),this.$$setStateInfo=function(t,r){u=e.get(t,stateContext(a)),f=r,n()},t.$on("$stateChangeSuccess",n)}]}}$StateRefDirective.$inject=["$state","$timeout"],$StateRefActiveDirective.$inject=["$state","$stateParams","$interpolate"],angular.module("ui.router.state").directive("uiSref",$StateRefDirective).directive("uiSrefActive",$StateRefActiveDirective).directive("uiSrefActiveEq",$StateRefActiveDirective);